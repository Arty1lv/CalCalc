<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>TinyWife</title>
  <link rel="stylesheet" href="style.css?v=17.21">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f6f7fb">
  <link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
  <div class="master-header" id="masterHeader">
    <div class="top" id="mainDashboard">
      <!-- Top Section: Persistent Title & Progress -->
      <div class="dash-top">
        <div class="header-main-row">
          <div id="appTitle" style="font-size:18px;font-weight:900">TinyWife</div>
          <div class="mutedOnBlue clickable" id="headerDateContainer">
            <span id="uiDate"></span> <span id="uiDebugTag"></span>
            <input id="datePicker" type="date" class="hidden">
          </div>
        </div>
        <div class="fullBar"><div id="limitBar"></div></div>
      </div>

      <!-- Middle Section: Collapsible Metrics -->
      <div class="dash-middle" id="dashMiddle">
        <div class="row" id="mainPillsRow" style="margin-top:12px">
          <div class="pill">
            <div class="muted">–°—ä–µ–¥–µ–Ω–æ</div>
            <div class="big" id="todayEat">0</div>
            <div class="muted">–∫–∫–∞–ª</div>
          </div>
          <div class="pill">
            <div class="muted">–°–æ–∂–∂–µ–Ω–æ (—É–ø—Ä.)</div>
            <div class="big" id="todayBurn">0</div>
            <div class="muted">–∫–∫–∞–ª</div>
            <div class="muted" id="bmrInfo" style="margin-top:6px"></div>
          </div>
          <div class="pill clickable" id="netTile" title="–ù–∞–∂–º–∏ –¥–ª—è —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞">
            <div class="muted" id="nettoTitle">–ù–µ—Ç—Ç–æ</div>
            <div class="big" id="todayNet">0</div>
            <div class="muted" id="nettoLabel"></div>
          </div>
          <div class="pill" id="trackerTile" style="min-width:200px">
            <div class="muted">–ë–µ–ª–æ–∫</div>
            <div class="big" id="uiProtein">0/0 –≥</div>
            <div class="muted" style="margin-top:6px">–í–æ–¥–∞</div>
            <div class="big" id="uiWater">0/2000 –º–ª</div>
          </div>
        </div>

      <div class="pill" id="dashFieldsRow" style="margin-top:12px; display:flex; padding: 10px;">
        <div style="display:flex; gap:10px; justify-content: space-around; align-items: center; width: 100%;">
          <div class="dash-field-input-wrapper">
            <span class="dash-field-icon">üë£</span>
            <input id="dashSteps" name="steps" class="dash-field-input" type="number" placeholder="–®–∞–≥–∏" title="–®–∞–≥–∏ –∑–∞ –¥–µ–Ω—å" autocomplete="off"/>
          </div>
          <div class="dash-field-input-wrapper">
            <span class="dash-field-icon">‚öñÔ∏è</span>
            <input id="dashWeight" name="bodyWeight" class="dash-field-input" type="number" step="0.1" placeholder="–í–µ—Å" title="–í–∞—à –≤–µ—Å" autocomplete="off"/>
          </div>
        </div>
      </div>
      </div>

      <!-- Bottom Section: Persistent Status -->
      <div class="dash-bottom">
        <div class="status" id="status"></div>
      </div>
    </div>

    <div class="tabs">
      <button class="tabbtn active" data-tab="day">–ì–ª–∞–≤–Ω–∞—è</button>
      <button class="tabbtn" data-tab="activities">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
      <button class="tabbtn" data-tab="food">–ï–¥–∞</button>
      <button class="tabbtn" data-tab="barcode">–°–∫–∞–Ω</button>
      <button class="tabbtn" data-tab="log">–õ–æ–≥</button>
      <button class="tabbtn" data-tab="data">–î–∞–Ω–Ω—ã–µ</button>
      <button class="tabbtn" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>
    
    <div id="foodStickyControls" class="sticky-tab-controls" style="display:none">
      <div class="sub-tabs">
        <button class="tabbtn active food-sub-tab" data-food-type="ingredient">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</button>
        <button class="tabbtn food-sub-tab" data-food-type="liquid">–ù–∞–ø–∏—Ç–∫–∏</button>
        <button class="tabbtn food-sub-tab" data-food-type="recipe">–ë–ª—é–¥–∞</button>
        <button class="tabbtn food-sub-tab" data-food-type="snack">–í–∫—É—Å–Ω—è—à–∫–∏</button>
      </div>
      <div id="foodSearchContainer"></div>
    </div>
    <div id="activitiesStickyControls" class="sticky-tab-controls" style="display:none">
      <div id="activitiesSearchContainer"></div>
    </div>
  </div>



  <div id="day" class="tab active">
    <div class="tabHeader">
      <div class="tabTitle">–°–≤–æ–¥–∫–∞ –¥–Ω—è</div>
      <div class="todayToggleRow">
        <div class="muted">–î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –¥–∞—Ç—É –≤ —à–∞–ø–∫–µ ‚Äî –≤—ã–±–æ—Ä –¥–Ω—è.</div>
      </div>
    </div>

    <div class="grid2 one" id="dayGrid">
      <div class="todayBox">
        <div style="font-weight:900">–ó–∞–≤—Ç—Ä–∞–∫</div>
        <div id="dayBreakfastList" style="margin-top:10px"></div>
      </div>
      <div class="todayBox">
        <div style="font-weight:900">–û–±–µ–¥</div>
        <div id="dayLunchList" style="margin-top:10px"></div>
      </div>
      <div class="todayBox">
        <div style="font-weight:900">–£–∂–∏–Ω</div>
        <div id="dayDinnerList" style="margin-top:10px"></div>
      </div>
      <div class="todayBox">
        <div style="font-weight:900">–í–∫—É—Å–Ω—è—à–∫–∏</div>
        <div id="dayTreatList" style="margin-top:10px"></div>
      </div>
      <div class="todayBox">
        <div style="font-weight:900">–ü–µ—Ä–µ–∫—É—Å—ã</div>
        <div id="daySnacksList" style="margin-top:10px"></div>
      </div>
      <div class="todayBox">
        <div style="font-weight:900">–ó–∞–Ω—è—Ç–∏—è</div>
        <div id="dayActivitiesList" style="margin-top:10px"></div>
      </div>
    </div>
    
    <div id="dayOverallSummary" style="margin-top: 20px;"></div>
  </div>

  <div id="food" class="tab">
    <div class="grid2 one" id="foodGrid">
      <div><div id="foodList"></div></div>
    </div>
  </div>

  <div id="activities" class="tab">
    <div class="grid2 one" id="activitiesGrid">
      <div>
        <div id="activityList"></div>
      </div>
    </div>
  </div>

  <div id="barcode" class="tab">
    <div class="tabHeader">
      <div class="tabTitle">–®—Ç—Ä–∏—Ö–∫–æ–¥</div>
      <div class="todayToggleRow">
        <button class="btn secondary" id="btnBarcodePaste">–í—Å—Ç–∞–≤–∏—Ç—å</button>
        <button class="btn secondary" id="btnScanStart">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn secondary hidden" id="btnScanStop">–°—Ç–æ–ø</button>
        <button class="btn" id="btnBarcodeSearch">–ù–∞–π—Ç–∏</button>
      </div>
    </div>

    <div class="card">
      <div class="muted">–®—Ç—Ä–∏—Ö–∫–æ–¥</div>
      <input id="barcodeInput" inputmode="numeric" placeholder="–ù–∞–ø—Ä. 3017624010701"/>
      <div class="muted" style="margin-top:8px">–ü–æ–∏—Å–∫ –∏–¥—ë—Ç –≤ Open Food Facts.</div>
    </div>

    <div class="card hidden" id="scanCard">
      <div style="font-weight:900">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
      <div class="muted" style="margin-top:6px">–ù—É–∂–Ω–æ HTTPS –∏ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–Ω–æ–ø–∫–∞ ‚Äú–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù).</div>
      <div class="scanOverlay" style="margin-top:10px">
        <video id="scanVideo" class="scanVideo" autoplay playsinline muted></video>
        <div class="scanHint" id="scanHint">–û–∂–∏–¥–∞–Ω–∏–µ‚Ä¶</div>
        <button id="btnSwitchCamera" class="btn secondary tiny" style="position:absolute; top:10px; right:10px; z-index:10; background:rgba(255,255,255,0.8)">üì∑ –°–º–µ–Ω–∞</button>
      </div>
      <div class="muted" style="margin-top:8px">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ZXing (JS-–¥–µ–∫–æ–¥–µ—Ä), —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–º, –≥–¥–µ BarcodeDetector –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.</div>
    </div>

    <div id="barcodeResult"></div>
  </div>

  <div id="log" class="tab">
    <div class="grid2">
      <div class="card">
        <div style="font-weight:900">–ó–∞–º–µ—Ç–∫–∏</div>
        <textarea id="notes" placeholder=""></textarea>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
          <button class="btn" id="btnSaveDay">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ–Ω—å + backup</button>
          <button class="btn danger" id="btnResetDay">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
        <div class="muted" style="margin-top:8px">–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è backup.json.</div>
      </div>

      <div class="card">
        <div style="font-weight:900">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏</div>
        <div id="logList" class="muted"></div>
      </div>
    </div>
  </div>

  <div id="settings" class="tab">

    


    <div class="card">
      <div style="font-weight:900">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
      <div class="muted" style="margin-top:6px">BMR</div>

      <div class="grid2" style="margin-top:10px">
          <div>
            <div class="muted">–í–µ—Å (–∫–≥)</div>
            <input id="weight" type="number" step="0.1" placeholder="55.0">
            <div class="muted" style="margin-top:6px">–ù—É–∂–µ–Ω –¥–ª—è BMR –∏ —Ü–µ–ª–∏ –±–µ–ª–∫–∞.</div>
          </div>

        <div>
          <div class="muted">–†–æ—Å—Ç</div>
          <input id="setHeight" type="number" min="80" max="250" step="1" placeholder="152"/>
        </div>
        <div>
          <div class="muted">–í–æ–∑—Ä–∞—Å—Ç</div>
          <input id="setAge" type="number" min="12" max="90" step="1" placeholder="30"/>
        </div>
      </div>

      <div style="margin-top:10px">
        <div class="muted">–ü–æ–ª</div>
        <select id="setSex">
          <option value="female">–ñ</option>
          <option value="male">–ú</option>
        </select>
      </div>

      <div style="margin-top:10px">
        <div class="muted">–ú–Ω–æ–∂–∏—Ç–µ–ª—å BMR</div>
        <input id="bmrMultiplier" type="number" min="1" max="2" step="0.05" placeholder="1.20"/>
      </div>

      <div style="margin-top:10px">
        <div class="muted">–¶–µ–ª—å (–∫–∫–∞–ª/–¥–µ–Ω—å)</div>
        <input id="goalKcal" type="number" step="10" placeholder="-400"/>
        <div class="muted" style="margin-top:6px">–ù–∞–ø—Ä. -400 = –¥–µ—Ñ–∏—Ü–∏—Ç 400 –∫–∫–∞–ª.</div>
      </div>

      
        <div class="row2" style="margin-top:10px">
          <div>
            <div class="muted">–ë–µ–ª–æ–∫ (–≥/–∫–≥)</div>
            <input id="proteinPerKg" type="number" min="0.2" max="3" step="0.01" placeholder="0.83">
          </div>
          <div>
            <div class="muted">–í–æ–¥–∞ (–º–ª/–¥–µ–Ω—å)</div>
            <input id="waterGoalMl" type="number" min="0" step="50" placeholder="2000">
          </div>
        </div>
        <div class="muted" style="margin-top:6px">–¶–µ–ª—å –±–µ–ª–∫–∞: –≤–µ—Å √ó –≥/–∫–≥.</div>
<div style="margin-top:10px">
        <div class="muted">–†–µ–∂–∏–º –Ω–µ—Ç—Ç–æ</div>
        <select id="nettoMode">
          <option value="nettonobmr">–°—ä–µ–¥–µ–Ω–æ ‚àí —Å–ø–æ—Ä—Ç</option>
          <option value="nettowithbmr">–°—ä–µ–¥–µ–Ω–æ ‚àí —Å–ø–æ—Ä—Ç ‚àí BMR</option>
          <option value="consumedlimit">–°—ä–µ–¥–µ–Ω–æ / –ª–∏–º–∏—Ç</option>
          <option value="remaining">–û—Å—Ç–∞–ª–æ—Å—å –¥–æ –ª–∏–º–∏—Ç–∞</option>
        </select>
      </div>

      <div style="margin-top:10px">
        <div class="muted">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
        <input id="setAppTitle" placeholder="" maxlength="50"/>
      </div>

      <div style="margin-top:10px">
        <div class="muted">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø–µ—Ä–µ–∫—É—Å–æ–≤</div>
        <input id="labelSnackBank" placeholder="–í–∫—É—Å–Ω—è—à–∫–∏" maxlength="20"/>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div>
          <div class="muted">–¶–≤–µ—Ç —à–∞–ø–∫–∏ (—Å–µ–≥–æ–¥–Ω—è)</div>
          <input id="topColorToday" type="color" value="#2f6fed"/>
        </div>
        <div>
          <div class="muted">–¶–≤–µ—Ç —à–∞–ø–∫–∏ (–ø—Ä–æ—à–ª—ã–µ –¥–Ω–∏)</div>
          <input id="topColorPast" type="color" value="#ec4899"/>
        </div>
      </div>

      <label class="check" style="margin-top:10px"><input id="darkTheme" type="checkbox"> <span>–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span></label>


      <div class="muted" style="margin-top:10px">BMR —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ Mifflin-St Jeor: 10W + 6.25H ‚àí 5A + S.</div>

      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
        <button class="btn secondary" id="btnSaveSettings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button class="btn secondary" id="btnPersist">Persist storage</button>
      </div>
    </div>

    <div class="card" style="margin-top:10px">
      <label style="display:flex; gap:10px; align-items:center">
        <input type="checkbox" id="autoSaveOnNewDay" style="width:auto; transform:scale(1.2)"/>
        <span>–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–µ–Ω—å –ø—Ä–∏ —Å–º–µ–Ω–µ –¥–∞—Ç—ã</span>
      </label>
      <div class="muted" style="margin-top:8px">–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
    </div>

    <div class="card" style="margin-top:10px">
      <label style="display:flex; gap:10px; align-items:center">
        <input type="checkbox" id="sortFreqEnabled" style="width:auto; transform:scale(1.2)"/>
        <span>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ</span>
      </label>
      <div class="muted" style="margin-top:8px">–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ.</div>
    </div>

    <div class="card" style="margin-top:10px">
      <label style="display:flex; gap:10px; align-items:center">
        <input type="checkbox" id="favoritesEnabled" style="width:auto; transform:scale(1.2)"/>
        <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
      </label>
      <div class="muted" style="margin-top:8px">–ú–æ–∂–Ω–æ –æ—Ç–º–µ—á–∞—Ç—å –±–ª—é–¥–∞/–∑–∞–Ω—è—Ç–∏—è –∑–≤—ë–∑–¥–æ—á–∫–æ–π.</div>
    </div>

    <div class="card" style="margin-top:10px">
      <div style="font-weight:900">Debug</div>
      <label style="display:flex; gap:10px; align-items:center; margin-top:10px">
        <input type="checkbox" id="dbgEnabled" style="width:auto; transform:scale(1.2)"/>
        <span>Debug date +1</span>
      </label>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
        <button class="btn secondary" id="dbgReset">Reset date</button>
      </div>
    </div>

    <div class="card" id="notificationsSection" style="margin-top:10px">
      <details id="notificationsContent">
        <summary class="section-header" style="font-weight:900; cursor:pointer; list-style:none; display:flex; justify-content:space-between; align-items:center">
          <span>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
          <span class="muted" style="font-size:12px">‚ñº</span>
        </summary>
        <div class="muted" style="margin-top:6px">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.</div>
        
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
          <button class="btn secondary" id="btnAddNotification">+ –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
          <button class="btn secondary" id="btnToggleNotifications" style="display:none">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
        </div>

        <div id="notificationsList" style="margin-top:10px">
          <!-- Notification cards will be injected here -->
        </div>
      </details>
    </div>

    <div class="card" style="margin-top:10px; border:2px solid #dc2626; background:#fef2f2">
      <div style="font-weight:900; color:#dc2626">–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</div>
      <div class="muted" style="margin-top:6px">–°–±—Ä–æ—Å–∏—Ç –≤–µ—Å—å –∂—É—Ä–Ω–∞–ª (–ª–æ–≥–∏) ‚Äî –±–ª—é–¥–∞/–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è.</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
        <button class="btn danger" id="btnResetJournal" style="padding:12px 20px; font-weight:900">–°–±—Ä–æ—Å–∏—Ç—å –∂—É—Ä–Ω–∞–ª</button>
      </div>
      <div class="muted" style="margin-top:12px">–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å ‚Äî —É–¥–∞–ª–∏—Ç –í–°–Å (–±–ª—é–¥–∞, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ª–æ–≥–∏).</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
        <button class="btn danger" id="btnFactoryReset" style="padding:8px 16px; font-size:12px">Factory Reset (Full Data Wipe)</button>
      </div>
    </div>
  </div>

  <div id="data" class="tab">
    <div class="grid2">
      <div class="card">
        <div style="font-weight:900">–ò–º–ø–æ—Ä—Ç backup.json</div>
        <input type="file" id="importFile" accept="application/json"/>
        <div class="muted" style="margin-top:8px">meals/activities/logs/shopping/meta.</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
          <button class="btn secondary" id="btnImport">–ò–º–ø–æ—Ä—Ç</button>
        </div>
      </div>

      <div class="card">
        <div style="font-weight:900">–ò–º–ø–æ—Ä—Ç —Ä–µ—Ü–µ–ø—Ç–∞/–±–∞–Ω–¥–ª–∞</div>
        <div class="muted">–ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç –∏–ª–∏ QR-–∫–æ–¥.</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
          <button class="btn secondary" id="btnImportBundle">–ò–º–ø–æ—Ä—Ç –±–∞–Ω–¥–ª–∞</button>
        </div>
      </div>

      <div class="card">
        <div style="font-weight:900">–≠–∫—Å–ø–æ—Ä—Ç</div>
        <div class="muted">–°–∫–∞—á–∞–µ—Ç backup.json.</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
          <button class="btn secondary" id="btnExport">–≠–∫—Å–ø–æ—Ä—Ç backup</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="font-weight:900">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</div>
      <textarea id="shopping" placeholder="12 —è–∏—Ü&#10;300 –≥ –∫—É—Ä–∏—Ü—ã&#10;..."></textarea>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
        <button class="btn secondary" id="btnSaveShopping">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modalBack" id="portionModalBack">
    <div class="modal" id="portionModal">
      <h3 id="portionModalTitle">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ—Ä—Ü–∏—é</h3>
      <div id="portionModalBody">
        <div class="card">
          <div style="font-weight:900" id="portionItemName"></div>
          <div style="display:flex; align-items:center; gap:10px; margin-top:10px">
            <div style="flex:1">
              <div class="muted">–ö–æ–ª-–≤–æ –ø–æ—Ä—Ü–∏–π</div>
              <input id="portionMultiplier" type="number" step="0.1" value="1" inputmode="decimal" />
            </div>
            <div style="flex:1">
              <div class="muted">–í–µ—Å (<span id="portionUnit">–≥</span>)</div>
              <input id="portionAmount" type="number" step="1" inputmode="numeric" />
            </div>
          </div>
          <div class="muted" style="margin-top:10px">
            –ò—Ç–æ–≥–æ: <span id="portionKcal" class="kcal">0</span> –∫–∫–∞–ª
          </div>
          <div class="muted" style="margin-top:4px">
            –ë–µ–ª–∫–∏: <span id="portionProtein">0</span> –≥, 
            –ñ–∏–¥–∫–æ—Å—Ç—å: <span id="portionFluid">0</span> –º–ª
          </div>
          
          <div id="portionIngredientsToggleWrapper" style="margin-top:10px; display:none">
            <button class="btn secondary tiny" style="width:100%" id="btnTogglePortionIngredients">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</button>
          </div>
          <div id="portionIngredientsList" style="margin-top:10px; display:none"></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn secondary" id="cancelPortionBtn">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" id="confirmPortionBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modalBack" id="modalBack">
    <div class="modal">
      <div style="margin-bottom:5%; display: flex; align-items: baseline; justify-content: space-between; gap: 10px; flex-wrap: wrap;">
      <h3 id="modalTitle" style="margin: 0;"></h3>
      <div id="modalScoreContainer" style="font-size: 0.9em; color: #666; cursor: pointer; font-weight: 400; padding: 2px 0; text-align: right;"></div>
      </div>
      <div id="modalBody" style="width: 100%; margin-top: 10px;"></div>
      <div class="actions" style="width: 100%;">
        <button class="btn danger" id="modalDelete" style="display:none;margin-right:auto">–£–¥–∞–ª–∏—Ç—å</button>
               <button class="btn secondary" id="modalExport" style="display:none;">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button class="btn secondary" id="modalCancel">–û—Ç–º–µ–Ω–∞</button>

        <button class="btn" id="modalOk">OK</button>
      </div>
    </div>
  </div>

  <div class="modalBack" id="secondaryModalBack" style="z-index: 1200;">
    <div class="modal">
      <h3 id="secondaryModalTitle"></h3>
      <div id="secondaryModalBody"></div>
      <div class="actions">
        <button class="btn secondary" id="secondaryModalCancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" id="secondaryModalOk">OK</button>
      </div>
    </div>
  </div>

  <div class="modalBack" id="recipeBuilderModalBack">
    <div class="modal" id="recipeBuilderModal">
         <div style="margin-bottom:5%; display: flex; align-items: baseline; justify-content: space-between; gap: 10px; flex-wrap: wrap;">
        <h3 style="margin: 0;">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ä–µ—Ü–µ–ø—Ç–∞</h3>
        <div id="recipeScoreContainer" style="font-size: 0.9em; color: #666; cursor: pointer; font-weight: 400; padding: 2px 0; text-align: right;"></div>
      </div>
      <div id="recipeBuilderBody">
        <div class="card">
          <div class="muted">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞</div>
          <input id="recipeName" placeholder="–ù–∞–ø—Ä. –ö—É—Ä–∏—Ü–∞ —Å —Ä–∏—Å–æ–º" />
          <div class="muted" style="margin-top:10px">–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</div>
          <input id="recipeShort" placeholder="–ù–∞–ø—Ä. –ù–∞ 2 –ø–æ—Ä—Ü–∏–∏" />
        </div>
        
        <button class="btn secondary" style="width:100%; margin-top:10px" id="btnAddIngredient">+ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</button>
        
        <div id="recipeIngredientList"></div>
        
        <div class="card" style="margin-top:10px">
          <div class="muted">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—é</div>
          <textarea id="recipePrep" placeholder="–®–∞–≥ 1, –®–∞–≥ 2..."></textarea>
        </div>

        <div class="card" style="margin-top:10px">
          <div style="font-weight:900">–ò—Ç–æ–≥–æ (–Ω–∞ –≤–µ—Å—å —Ä–µ—Ü–µ–ø—Ç):</div>
          <div class="kcal" id="recipeTotalKcal">0 –∫–∫–∞–ª</div>
          <div class="muted">
            –ë–µ–ª–∫–∏: <span id="recipeTotalProtein">0</span> –≥, 
            –ñ–∏–¥–∫–æ—Å—Ç—å: <span id="recipeTotalFluid">0</span> –º–ª
          </div>
          <div class="grid2" style="margin-top:10px; border-top:1px solid #eee; padding-top:10px">
            <div>
              <div class="muted">–°—ã—Ä–æ–π –≤–µ—Å (–≥)</div>
              <div id="recipeRawWeight" style="font-weight:900; margin-top:4px">0</div>
            </div>
            <div>
              <div class="muted">–ì–æ—Ç–æ–≤—ã–π –≤–µ—Å (–≥) <span id="recipeWeightDiff" style="font-size:11px; font-weight:normal"></span></div>
              <input type="number" id="recipeCookedWeight" value="0" style="margin-top:4px" />
            </div>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn danger" id="btnRecipeDelete" style="display:none; margin-right:auto">–£–¥–∞–ª–∏—Ç—å</button>
        <button class="btn secondary" id="btnRecipeShare" style="display:none">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
        <button class="btn secondary" id="btnRecipeCancel">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" id="btnRecipeSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modalBack" id="classificationModalBack">
    <div class="modal" id="classificationModal">
      <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
      <div id="classificationBody" style="display:flex; flex-direction:column; gap:10px">
        <button class="btn secondary btn-classify" data-classify="breakfast" style="height:60px; font-size:18px">–ó–∞–≤—Ç—Ä–∞–∫</button>
        <button class="btn secondary btn-classify" data-classify="lunch" style="height:60px; font-size:18px">–û–±–µ–¥</button>
        <button class="btn secondary btn-classify" data-classify="dinner" style="height:60px; font-size:18px">–£–∂–∏–Ω</button>
        <button class="btn secondary btn-classify" data-classify="snack" style="height:60px; font-size:18px">–ü–µ—Ä–µ–∫—É—Å</button>
        <button class="btn secondary btn-classify" data-classify="treat" style="height:60px; font-size:18px">–í–∫—É—Å–Ω—è—à–∫–∏</button>
      </div>
      <div class="actions">
        <button class="btn secondary" id="cancelClassifyBtn">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <div class="modalBack" id="shareModalBack" style="z-index: 1300;">
    <div class="modal" id="shareModal">
      <h3>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</h3>
      <div id="shareModalBody">
        <div class="card" style="text-align:center">
          <div id="shareItemName" style="font-weight:900; margin-bottom:10px"></div>
          <div style="display:flex; flex-direction:column; gap:10px; margin:20px 0">
            <button class="btn" id="btnShareLink" style="width:100%">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>
            <button class="btn secondary" id="btnCopyShareText" style="width:100%">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="closeShareBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <div class="modalBack" id="importModalBack" style="z-index: 1300;">
    <div class="modal" id="importModal">
      <h3>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
      <div id="importModalBody">
        <!-- Step 1: Input -->
        <div id="importStepInput">
          <div class="card">
            <div class="muted">–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</div>
            <textarea id="importPasteText" style="margin-top:10px; height:100px" placeholder='{"v":2, ...}'></textarea>
            <div style="display:flex; gap:10px; margin-top:10px">
              <button class="btn secondary" id="btnImportClipboard" style="flex:1">–ò–∑ –±—É—Ñ–µ—Ä–∞</button>
              <button class="btn secondary" id="btnImportFile" style="flex:1">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
              <input type="file" id="inputImportFile" class="hidden" accept=".jsonrecipe,.txt,application/json,text/plain"/>
            </div>
          </div>
        </div>

        <!-- Step 3: Review & Conflict Resolution -->
        <div id="importStepReview" class="hidden">
          <div id="importReviewList"></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn secondary" id="closeImportBtn">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn hidden" id="btnExecuteImport">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ</button>
      </div>
    </div>
  </div>

  <nav class="bottom-nav">
    <button class="nav-item active" data-nav="day">
      <span class="nav-icon">üè†</span>
      <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="nav-item" data-nav="activities">
      <span class="nav-icon">üèÉ</span>
      <span class="nav-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
    </button>
    <button class="nav-item" data-nav="food">
      <span class="nav-icon">üçé</span>
      <span class="nav-label">–ï–¥–∞</span>
    </button>
    <button class="nav-item" data-nav="more">
      <span class="nav-icon">‚ò∞</span>
      <span class="nav-label">–ú–µ–Ω—é</span>
    </button>
  </nav>

  <div id="moreMenu" class="modalBack" style="z-index: 2000;">
    <div class="modal">
      <h3>–ú–µ–Ω—é</h3>
      <div class="grid2">
        <button class="btn secondary" data-more-link="barcode">–°–∫–∞–Ω</button>
        <button class="btn secondary" data-more-link="log">–õ–æ–≥</button>
        <button class="btn secondary" data-more-link="data">–î–∞–Ω–Ω—ã–µ</button>
        <button class="btn secondary" data-more-link="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button class="btn secondary" data-more-link="import-bundle">–ò–º–ø–æ—Ä—Ç –±–∞–Ω–¥–ª–∞</button>
      </div>
      <div style="margin-top: 20px; text-align: center;">
        <button class="btn" id="closeMoreMenu">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <button id="fab" class="fab" style="display:none" title="–î–æ–±–∞–≤–∏—Ç—å">+</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
  <script src="sharingService.js?v=17.33"></script>
  <script src="script.js?v=17.33"></script>
</body>
</html>
